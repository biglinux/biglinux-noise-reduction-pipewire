#!/bin/bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-noise-reduction-pipewire

if [ "$1" = "start" ];then
    notify-send $"Ativado!" --app-name=$"Microfone sem ruídos"
    exit
fi

if [ "$1" = "stop" ];then
    notify-send $"Desativado!" --app-name=$"Microfone sem ruídos"
    exit
fi

mic_name=$"Microfone sem ruídos"

if [ ! -e "$HOME/.config/pipewire/filter-chain.conf.d/source-rnnoise.conf" ]; then

    mkdir -p ~/.config/pipewire/filter-chain.conf.d
    cp -f /usr/share/pipewire/filter-chain/source-rnnoise.conf ~/.config/pipewire/filter-chain.conf.d/source-rnnoise.conf
    sed -i "s|node.description =.*|node.description = \"$mic_name\"|g" ~/.config/pipewire/filter-chain.conf.d/source-rnnoise.conf
fi

pipewire-noise-move-mic &

/usr/bin/pipewire -c filter-chain.conf
